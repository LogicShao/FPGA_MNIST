# README_v1 - Nios II + SimpleMLP å®ç°è·¯çº¿ï¼ˆv1ï¼‰

> **çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ / Legacy
> **æ¶æ„**ï¼šNios II è½¯æ ¸ + SimpleMLPï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰
> **æ¨ç†æ—¶é—´**ï¼š14 ms @ 50 MHz
> **å½“å‰ä¸»çº¿**ï¼š[v1.1](hardware/src/v1.1/) - çº¯ Verilog + TinyLeNetï¼ˆå·ç§¯ç¥ç»ç½‘ç»œï¼‰

---

## ğŸ“‹ ç›®å½•

1. [æŠ€æœ¯è·¯çº¿è¯´æ˜](#æŠ€æœ¯è·¯çº¿è¯´æ˜)
2. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
3. [SimpleMLP æ¨¡å‹](#simplemlp-æ¨¡å‹)
4. [èµ„æºå ç”¨](#èµ„æºå ç”¨)
5. [æ€§èƒ½è¡¨ç°](#æ€§èƒ½è¡¨ç°)
6. [ä¼˜åŠ¿ä¸é™åˆ¶](#ä¼˜åŠ¿ä¸é™åˆ¶)
7. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
8. [æŠ€æœ¯ç»éªŒ](#æŠ€æœ¯ç»éªŒ)

---

## æŠ€æœ¯è·¯çº¿è¯´æ˜

æœ¬é¡¹ç›®æ¢ç´¢äº†ä¸¤ç§ä¸åŒçš„ FPGA å®ç°è·¯çº¿ï¼š

| ç‰ˆæœ¬ | ç¡¬ä»¶æ¶æ„ | ç¥ç»ç½‘ç»œæ¨¡å‹ | æ¨ç†æ–¹å¼ | çŠ¶æ€ |
|------|---------|------------|---------|------|
| **v1** | Nios II è½¯æ ¸ | SimpleMLPï¼ˆå…¨è¿æ¥ï¼‰ | C è¯­è¨€ä¸²è¡Œæ¨ç† | âœ… å·²å®Œæˆ |
| **v1.1** | çº¯ Verilog RTL | TinyLeNetï¼ˆå·ç§¯ï¼‰ | ç¡¬ä»¶å¹¶è¡ŒåŠ é€Ÿ | âœ… å·²å®Œæˆ |

**å…³é”®å·®å¼‚**ï¼š
- **v1** ä½¿ç”¨è½¯æ ¸å¤„ç†å™¨ï¼Œé€‚åˆå¿«é€ŸåŸå‹å¼€å‘
- **v1.1** ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶ï¼Œè¿½æ±‚æè‡´æ€§èƒ½ä¸èµ„æºåˆ©ç”¨

**é‡è¦è¯´æ˜**ï¼šä¸¤ä¸ªç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„ç¥ç»ç½‘ç»œæ¶æ„ï¼Œ**æ€§èƒ½ä¸å…·å¤‡ç›´æ¥å¯æ¯”æ€§**ã€‚

---

## æ¶æ„æ¦‚è¿°

### ç³»ç»Ÿæ¡†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FPGA (EP4CE10)                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Nios II System (Qsys)                â”‚     â”‚
â”‚  â”‚                                                   â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚     â”‚
â”‚  â”‚  â”‚  Nios II/f  â”‚â”€â”€â”€â†’â”‚  On-Chip RAM â”‚             â”‚     â”‚
â”‚  â”‚  â”‚  Processor  â”‚    â”‚   (32 KB)    â”‚             â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚     â”‚
â”‚  â”‚         â”‚                    â”‚                   â”‚     â”‚
â”‚  â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”           â”‚     â”‚
â”‚  â”‚         â”‚                            â”‚           â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚
â”‚  â”‚  â”‚ UART (JTAG) â”‚            â”‚   GPIO       â”‚    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                             â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   UART RX    â”‚              â”‚  7-Seg LED   â”‚          â”‚
â”‚  â”‚   (Serial)   â”‚              â”‚  (74HC595)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                                â–¼
         â”‚                                â”‚
    [PC å‘é€å›¾åƒ]                   [æ•°ç ç®¡æ˜¾ç¤ºç»“æœ]
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | è¯´æ˜ | èµ„æºå ç”¨ |
|------|------|-----------------|
| **Nios II/f** | å¿«é€Ÿå‹è½¯æ ¸å¤„ç†å™¨ï¼ˆæ€§èƒ½æœ€å¼ºï¼‰ | åŒ…å«åœ¨ Qsys ç³»ç»Ÿä¸­ |
| **Qsys ç³»ç»Ÿ** | Nios II + UART + Timer + Avalon æ€»çº¿ | 3,264 LCs âœ… *å®æµ‹* |
| **On-Chip RAM** | ä»£ç ä¸æ•°æ®å­˜å‚¨ï¼ˆ32 KBï¼‰ | 44 Ã— M9K å—ï¼ˆ95.7%ï¼‰âœ… *å®æµ‹* |
| **æ•°ç ç®¡é©±åŠ¨** | 74HC595 ä¸²è¡Œé©±åŠ¨ | 225 LCs âœ… *å®æµ‹* |
| **è°ƒè¯•æ¥å£** | SignalTapï¼ˆå¯é€‰ï¼‰ | 191 LCs âœ… *å®æµ‹* |
| **å…¶ä»–å¤–è®¾** | è‡ªå®šä¹‰å¤–è®¾ | 124 LCs âœ… *å®æµ‹* |

**å†…å­˜åˆ†é…**ï¼ˆ32 KB On-Chip RAMï¼‰ğŸ“Š *ä¼°ç®—*ï¼š
- ä»£ç æ®µï¼ˆ.textï¼‰ï¼š~10 KB
- æ•°æ®æ®µï¼ˆ.data/.bssï¼‰ï¼š~2 KB
- å †æ ˆï¼ˆstack/heapï¼‰ï¼š~4 KB
- SimpleMLP æƒé‡ï¼š~25 KBï¼ˆ784Ã—32 + 32Ã—10 â‰ˆ 25,408 å­—èŠ‚ï¼‰
- ç‰¹å¾ç¼“å­˜ï¼š~0.5 KBï¼ˆè¾“å…¥ 784 + éšå±‚ 32 + è¾“å‡º 10ï¼‰

> **è¯´æ˜**ï¼šä»¥ä¸Šä¸ºåŸºäºç¨‹åºç»“æ„çš„åˆç†ä¼°ç®—ï¼Œå®é™…åˆ†é…å¯èƒ½å› ç¼–è¯‘ä¼˜åŒ–è€Œç•¥æœ‰å·®å¼‚ã€‚

---

## SimpleMLP æ¨¡å‹

### ç½‘ç»œç»“æ„

v1 ç‰ˆæœ¬ä½¿ç”¨ **SimpleMLP**ï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¸¤å±‚å…¨è¿æ¥ç½‘ç»œï¼š

```
è¾“å…¥å±‚ (784)
    â†“
å…¨è¿æ¥å±‚ 1: 784 â†’ 32
    â†“
ReLU æ¿€æ´»
    â†“
å…¨è¿æ¥å±‚ 2: 32 â†’ 10
    â†“
è¾“å‡ºå±‚ (10 classes)
```

**ä¸ TinyLeNet çš„å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | SimpleMLP (v1) | TinyLeNet (v1.1) |
|------|---------------|------------------|
| **ç½‘ç»œç±»å‹** | å…¨è¿æ¥ï¼ˆMLPï¼‰ | å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ |
| **å±‚æ•°** | 2 å±‚ | 4 å±‚ï¼ˆ2 å·ç§¯ + 2 å…¨è¿æ¥ï¼‰ |
| **å‚æ•°é‡** | ~25 KB | ~150 KB |
| **å‡†ç¡®ç‡** | ~95-96% | ~99% |
| **è®¡ç®—å¤æ‚åº¦** | ä½ï¼ˆä»…çŸ©é˜µä¹˜æ³•ï¼‰ | é«˜ï¼ˆå·ç§¯ + æ± åŒ– + å…¨è¿æ¥ï¼‰ |

**é€‰æ‹© SimpleMLP çš„åŸå› **ï¼š
- âœ… **å†…å­˜å‹å¥½**ï¼š25 KB æƒé‡å¯å®Œå…¨æ”¾å…¥ 32 KB RAM
- âœ… **è®¡ç®—ç®€å•**ï¼šä¸¤å±‚å…¨è¿æ¥ï¼Œé€‚åˆ CPU ä¸²è¡Œè®¡ç®—
- âœ… **å¿«é€Ÿå¼€å‘**ï¼šç½‘ç»œç»“æ„ç®€å•ï¼Œæ˜“äº C è¯­è¨€å®ç°
- âš ï¸ **ç²¾åº¦è¾ƒä½**ï¼šç›¸æ¯” CNNï¼Œå‡†ç¡®ç‡ç•¥ä½ï¼ˆ95% vs 99%ï¼‰

### æ¨¡å‹å®šä¹‰ï¼ˆPythonï¼‰

```python
# model_tools/models/SimpleMLP.py
import torch.nn as nn

HIDDEN_SIZE = 32  # éšå±‚èŠ‚ç‚¹æ•°

class SimpleMLP(nn.Module):
    def __init__(self):
        super(SimpleMLP, self).__init__()
        self.flatten = nn.Flatten()
        # Layer 1: 784 â†’ 32
        self.fc1 = nn.Linear(28 * 28, HIDDEN_SIZE)
        self.relu = nn.ReLU()
        # Layer 2: 32 â†’ 10
        self.fc2 = nn.Linear(HIDDEN_SIZE, 10)

    def forward(self, x):
        x = self.flatten(x)
        x = self.fc1(x)
        x = self.relu(x)
        x = self.fc2(x)
        return x
```

### è½¯ä»¶å®ç°ï¼ˆC ä¼ªä»£ç ï¼‰

```c
// Nios II ä¸Šçš„ SimpleMLP æ¨ç†
int8_t weights_fc1[784][32];   // ç¬¬ä¸€å±‚æƒé‡
int8_t weights_fc2[32][10];    // ç¬¬äºŒå±‚æƒé‡
int32_t bias_fc1[32];          // ç¬¬ä¸€å±‚åç½®
int32_t bias_fc2[10];          // ç¬¬äºŒå±‚åç½®

void inference(uint8_t image[784], int8_t result[10]) {
    // 1. å…¨è¿æ¥å±‚ 1: 784 â†’ 32
    int32_t hidden[32];
    for (int i = 0; i < 32; i++) {
        int64_t acc = bias_fc1[i];
        for (int j = 0; j < 784; j++) {
            acc += image[j] * weights_fc1[j][i];
        }
        // é‡åŒ–å¹¶åº”ç”¨ ReLU
        hidden[i] = quantize_and_relu(acc);
    }

    // 2. å…¨è¿æ¥å±‚ 2: 32 â†’ 10
    for (int i = 0; i < 10; i++) {
        int64_t acc = bias_fc2[i];
        for (int j = 0; j < 32; j++) {
            acc += hidden[j] * weights_fc2[j][i];
        }
        result[i] = quantize(acc);
    }
}
```

---

## èµ„æºå ç”¨

### FPGA èµ„æºç»Ÿè®¡ï¼ˆQuartus ç»¼åˆæŠ¥å‘Šï¼‰

**ç›®æ ‡å™¨ä»¶**ï¼šCyclone IV E **EP4CE10F17C8**

| èµ„æºç±»å‹ | ä½¿ç”¨é‡ | EP4CE10 æ€»é‡ | åˆ©ç”¨ç‡ |
|---------|--------|--------------|--------|
| **Logic Cells (LCs)** | **3,800** âœ… *å®æµ‹* | 10,320 | **36.8%** |
| **Dedicated Logic Registers** | **2,468** âœ… *å®æµ‹* | - | - |
| **M9K å­˜å‚¨å—** | **44** âœ… *å®æµ‹* | 46 | **95.7%** |
| **DSP Elements** | **4** âœ… *å®æµ‹* | 23 | **17.4%** |
| **DSP 18Ã—18** | **2** âœ… *å®æµ‹* | 23 | **8.7%** |

### èµ„æºåˆ†é…æ˜ç»†ï¼ˆå±‚çº§åˆ†è§£ï¼‰âœ… *Quartus æŠ¥å‘Š*

#### 1. **Qsys ç³»ç»Ÿ**ï¼ˆ`qsys_system:qsys_system_inst`ï¼‰
- **Logic Cells**: 3,264 LCs
- **Registers**: 2,139
- **M9K å—**: 44ï¼ˆåŒ…å« Nios II/f + 32KB On-Chip RAMï¼‰
- **DSP Elements**: 4
- **DSP 18Ã—18**: 2

**è¯´æ˜**ï¼šåŒ…å« Nios II/f å¤„ç†å™¨ã€32KB RAMã€UARTã€Timerã€Avalon æ€»çº¿ç­‰ã€‚

#### 2. **æ•°ç ç®¡é©±åŠ¨**ï¼ˆ`seg_595_dynamic:seg_595_dynamic_inst`ï¼‰
- **Logic Cells**: 225 LCs
- **Registers**: 148

#### 3. **SignalTap è°ƒè¯•æ¥å£**ï¼ˆ`sld_hub:auto_hub`ï¼‰
- **Logic Cells**: 191 LCs
- **Registers**: 109

**è¯´æ˜**ï¼šä»…åœ¨è°ƒè¯•æ—¶å­˜åœ¨ï¼Œå‘å¸ƒç‰ˆæœ¬å¯ç§»é™¤ä»¥èŠ‚çœèµ„æºã€‚

#### 4. **å…¶ä»–å¤–è®¾**ï¼ˆ`pzdyqx:nabboc`ï¼‰
- **Logic Cells**: 124 LCs
- **Registers**: 72

#### 5. **æ—¶é’Ÿ PLL**ï¼ˆ`clk_pll:niospll_inst`ï¼‰
- èµ„æºå ç”¨æå°‘ï¼ˆç”±ä¸“ç”¨ PLL æ¨¡å—å®ç°ï¼‰

**å…³é”®è§‚å¯Ÿ**ï¼š
- âš ï¸ **M9K å—æ¥è¿‘é¥±å’Œ**ï¼š44/46ï¼ˆ95.7%ï¼‰ï¼Œ32KB On-Chip RAM å·²è¾¾ EP4CE10 æé™
- âœ… **Logic Cells å……è¶³**ï¼š3,800/10,320ï¼ˆ36.8%ï¼‰ï¼Œå‰©ä½™ 63% å¯æ‰©å±•
- âœ… **DSP èµ„æºåˆ©ç”¨**ï¼šä½¿ç”¨ 2 ä¸ª DSP 18Ã—18 å•å…ƒï¼ˆå¯èƒ½ç”¨äº Nios II/f å†…éƒ¨ç¡¬ä»¶ä¹˜æ³•å™¨ï¼‰
- ğŸ” **è°ƒè¯•å¼€é”€**ï¼šSignalTap å ç”¨ 191 LCsï¼Œå‘å¸ƒæ—¶å¯ç§»é™¤èŠ‚çœèµ„æº

---

## æ€§èƒ½è¡¨ç°

### æ¨ç†æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ | å¤‡æ³¨ |
|------|------|------|
| **æ¨ç†å»¶è¿Ÿ** | **14 ms** âœ… *å®æµ‹* | å•å¼ å›¾åƒï¼Œ50 MHz |
| **ååç‡** | ~71 FPS ğŸ“ *è®¡ç®—å€¼* | $1000 / 14$ |
| **å‘¨æœŸæ•°** | ~700,000 ğŸ“ *è®¡ç®—å€¼* | $14 \text{ ms} \times 50 \text{ MHz}$ |

**è®¡ç®—å‘¨æœŸåˆ†æ** ğŸ“ *ç†è®ºæ¨å¯¼ï¼Œä»…ä¾›å‚è€ƒ*ï¼š

$$
\begin{aligned}
\text{FC1 è®¡ç®—:} \quad & 784 \times 32 = 25{,}088 \text{ æ¬¡ä¹˜åŠ } \\
\text{FC2 è®¡ç®—:} \quad & 32 \times 10 = 320 \text{ æ¬¡ä¹˜åŠ } \\
\text{æ€»ä¹˜åŠ :} \quad & 25{,}408 \text{ æ¬¡}
\end{aligned}
$$

âš ï¸ **å‡è®¾**ï¼šæ¯æ¬¡ä¹˜åŠ  20 å‘¨æœŸï¼ˆè½¯æ ¸è½¯ä»¶å®ç°ï¼Œæœªç²¾ç¡®æµ‹é‡ï¼‰

$$
25{,}408 \times 20 \approx 508{,}160 \text{ å‘¨æœŸ}
$$

åŠ ä¸Šé‡åŒ–ã€ReLUã€å†…å­˜è®¿é—®ç­‰å¼€é”€ï¼š

$$
\sim 700{,}000 \text{ å‘¨æœŸ} \approx 14 \text{ ms} @ 50 \text{ MHz}
$$

> **æ³¨**ï¼šä»¥ä¸Šå‘¨æœŸåˆ†æä¸ºç†è®ºä¼°ç®—ï¼Œå®é™…æ‰§è¡Œå‘¨æœŸå—ç¼–è¯‘å™¨ä¼˜åŒ–ã€cache missã€åˆ†æ”¯é¢„æµ‹ç­‰å› ç´ å½±å“ï¼Œæ­¤æ¨å¯¼ä»…ç”¨äºç†è§£æ•°é‡çº§å…³ç³»ã€‚å®æµ‹å»¶è¿Ÿä¸º 14msã€‚

### å‡†ç¡®ç‡

| æ•°æ®é›† | å‡†ç¡®ç‡ | å¤‡æ³¨ |
|--------|--------|------|
| **MNIST æµ‹è¯•é›†** | ~95-96% ğŸ“Š *å…¸å‹å€¼* | 10,000 å¼  |

**è¯´æ˜**ï¼šSimpleMLPï¼ˆä¸¤å±‚å…¨è¿æ¥ï¼‰åœ¨ MNIST æ•°æ®é›†ä¸Šçš„å…¸å‹å‡†ç¡®ç‡èŒƒå›´ä¸º 95-96%ï¼Œè¿™æ˜¯è¯¥æ¶æ„åœ¨ INT8 é‡åŒ–åçš„é¢„æœŸæ€§èƒ½ã€‚ç›¸æ¯” TinyLeNetï¼ˆ99%ï¼‰ï¼ŒSimpleMLP å‡†ç¡®ç‡è¾ƒä½ï¼Œä½†å¯¹äºå¿«é€ŸåŸå‹éªŒè¯å’Œèµ„æºå—é™åœºæ™¯å·²è¶³å¤Ÿã€‚

---

## ä¼˜åŠ¿ä¸é™åˆ¶

### Nios II + SimpleMLP æ–¹æ¡ˆçš„ä¼˜åŠ¿ âœ…

#### 1. **å¿«é€Ÿå¼€å‘** ğŸš€
- **C è¯­è¨€ç¼–ç¨‹**ï¼šå¼€å‘å‘¨æœŸçŸ­ï¼Œæ— éœ€æ·±å…¥ RTL è®¾è®¡
- **Eclipse IDE**ï¼šç†Ÿæ‚‰çš„å¼€å‘ç¯å¢ƒï¼Œæ”¯æŒ printf è°ƒè¯•
- **æ¨¡å—åŒ–ä»£ç **ï¼šæ˜“äºç†è§£å’Œç»´æŠ¤

#### 2. **çµæ´»è°ƒæ•´** ğŸ”§
- **ç®—æ³•è¿­ä»£**ï¼šä¿®æ”¹æ¨ç†é€»è¾‘åªéœ€é‡æ–°ç¼–è¯‘ C ä»£ç ï¼ˆç§’çº§ï¼‰
- **æ— éœ€é‡æ–°ç»¼åˆ**ï¼šè½¯ä»¶ä¿®æ”¹ä¸å½±å“ç¡¬ä»¶ï¼ŒèŠ‚çœç»¼åˆæ—¶é—´ï¼ˆæ•°ååˆ†é’Ÿï¼‰
- **å‚æ•°è°ƒä¼˜**ï¼šè½»æ¾å°è¯•ä¸åŒçš„é‡åŒ–ç­–ç•¥

#### 3. **ä½èµ„æºå ç”¨** ğŸ“Š
- **15% LCs**ï¼šå‰©ä½™ 85% å¯ç”¨äºå…¶ä»–åŠŸèƒ½
- **SimpleMLP å°å·§**ï¼šä»…éœ€ 25 KB æƒé‡ï¼Œé€‚åˆå°å®¹é‡ RAM

#### 4. **è°ƒè¯•å‹å¥½** ğŸ›
- **printf è¾“å‡º**ï¼šå®æ—¶æŸ¥çœ‹ä¸­é—´ç»“æœ
- **è½¯ä»¶æ–­ç‚¹**ï¼šEclipse æ”¯æŒå•æ­¥è°ƒè¯•
- **å¿«é€Ÿå®šä½é—®é¢˜**ï¼šè½¯ä»¶è°ƒè¯•æ¯”æ³¢å½¢åˆ†ææ›´ç›´è§‚

#### 5. **æ€§èƒ½å¯æ¥å—** âš¡
- **14 ms æ¨ç†**ï¼šæ»¡è¶³å¤§éƒ¨åˆ†éå®æ—¶åº”ç”¨
- **~71 FPS**ï¼šè¶³å¤Ÿç”¨äºè§†é¢‘æµå¤„ç†ï¼ˆ30 FPSï¼‰
- **ä½åŠŸè€—**ï¼š50 MHz ä¸»é¢‘ï¼ŒåŠŸè€—é€‚ä¸­

### æ–¹æ¡ˆé™åˆ¶ âš ï¸

#### 1. **å†…å­˜æ¥è¿‘æé™** ğŸ’¾
- **32 KB RAM**ï¼šæ¥è¿‘ EP4CE10 çš„ On-Chip RAM ä¸Šé™
- **æ— æ‰©å±•ç©ºé—´**ï¼šéš¾ä»¥æ”¯æŒæ›´å¤§çš„ç½‘ç»œï¼ˆå¦‚ TinyLeNetï¼‰
- **å¤–éƒ¨ SDRAM**ï¼šå¯æ‰©å±•ï¼Œä½†å¢åŠ å¤æ‚åº¦ä¸å»¶è¿Ÿ

#### 2. **å‡†ç¡®ç‡è¾ƒä½** ğŸ“‰
- **SimpleMLP: ~95%**ï¼šç›¸æ¯” TinyLeNetï¼ˆ99%ï¼‰ä½ 4%
- **æ— å·ç§¯å±‚**ï¼šä¸¢å¤±ç©ºé—´ç‰¹å¾æå–èƒ½åŠ›
- **ä»…é€‚ç”¨ç®€å•ä»»åŠ¡**ï¼šå¤æ‚å›¾åƒè¯†åˆ«èƒ½åŠ›æœ‰é™

#### 3. **æ€§èƒ½å—é™äº CPU** ğŸŒ
- **è½¯ä»¶ä¹˜æ³•**ï¼šæœªä½¿ç”¨ DSPï¼Œæ¯æ¬¡ä¹˜æ³•å¤šä¸ªå‘¨æœŸ
- **ä¸²è¡Œè®¡ç®—**ï¼šæ— æ³•å¹¶è¡ŒåŒ–çŸ©é˜µè¿ç®—
- **é¢‘ç‡é™åˆ¶**ï¼š50 MHz å— Nios II æ—¶åºçº¦æŸ

#### 4. **ä¸é€‚åˆæ‰©å±•** ğŸš«
- **æ›´å¤æ‚ç½‘ç»œ**ï¼šå·ç§¯å±‚éš¾ä»¥é«˜æ•ˆå®ç°
- **æ‰¹å¤„ç†**ï¼šå†…å­˜ä¸è¶³ä»¥æ”¯æŒå¤šå›¾å¹¶è¡Œ
- **å®æ—¶æ€§è¦æ±‚**ï¼š14 ms å¯¹äºæŸäº›åº”ç”¨ä»åæ…¢

---

## ç›®å½•ç»“æ„

```
hardware/src/v1/  (Nios II + SimpleMLP ç‰ˆæœ¬)
â”œâ”€â”€ hardware/
â”‚   â”œâ”€â”€ mnist_nios.v          # Qsys ç”Ÿæˆçš„é¡¶å±‚ï¼ˆåŒ…å« Nios IIï¼‰
â”‚   â”œâ”€â”€ IPcore/               # PLL ç­‰ IP æ ¸
â”‚   â”‚   â”œâ”€â”€ clk_pll.v
â”‚   â”‚   â”œâ”€â”€ clk_pll_bb.v
â”‚   â”‚   â””â”€â”€ clk_pll_inst.v
â”‚   â””â”€â”€ seg/                  # æ•°ç ç®¡é©±åŠ¨æ¨¡å—ï¼ˆå¯å¤ç”¨ï¼‰
â”‚       â”œâ”€â”€ seg_595_dynamic.v
â”‚       â”œâ”€â”€ hc595_ctrl.v
â”‚       â”œâ”€â”€ seg_dynamic.v
â”‚       â””â”€â”€ bcd_8421.v
â”œâ”€â”€ software/                 # Nios II C ä»£ç 
â”‚   â”œâ”€â”€ main.c                # ä¸»ç¨‹åºï¼ˆæ¨ç†å¾ªç¯ï¼‰
â”‚   â”œâ”€â”€ SimpleMLP.c           # SimpleMLP æ¨ç†å®ç°
â”‚   â”œâ”€â”€ weights.h             # æƒé‡æ•°æ®ï¼ˆåµŒå…¥ï¼‰
â”‚   â””â”€â”€ uart.c                # UART é€šä¿¡é©±åŠ¨
â””â”€â”€ README.md                 # ç®€è¦è¯´æ˜
```

---

## æŠ€æœ¯ç»éªŒ

### æˆåŠŸç»éªŒ âœ…

#### 1. **æ¨¡å—åŒ–å¤–è®¾è®¾è®¡**
v1 ä¸­çš„æ•°ç ç®¡é©±åŠ¨æ¨¡å—åœ¨ v1.1 ä¸­å®Œå…¨å¤ç”¨ï¼š
- âœ… `seg_595_dynamic.v` - æ•°ç ç®¡é©±åŠ¨
- âœ… `hc595_ctrl.v` - 74HC595 æ§åˆ¶å™¨
- âœ… `bcd_8421.v` - BCD è¯‘ç å™¨

**å¯ç¤º**ï¼šè‰¯å¥½çš„æ¨¡å—åŒ–è®¾è®¡å¯è·¨ç‰ˆæœ¬å¤ç”¨ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´ã€‚

#### 2. **SimpleMLP çš„åˆç†é€‰æ‹©**
- âœ… 25 KB æƒé‡é€‚é… 32 KB RAM
- âœ… è®¡ç®—ç®€å•ï¼Œé€‚åˆ CPU ä¸²è¡Œæ¨ç†
- âœ… å¼€å‘å‘¨æœŸçŸ­ï¼Œå¿«é€ŸéªŒè¯æ–¹æ¡ˆå¯è¡Œæ€§

**å¯ç¤º**ï¼šé€‰æ‹©åˆé€‚çš„ç½‘ç»œæ¶æ„æ¯”ç›²ç›®è¿½æ±‚å¤æ‚åº¦æ›´é‡è¦ã€‚

#### 3. **C è¯­è¨€å¿«é€ŸåŸå‹**
- âœ… æ¨ç†é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºè°ƒè¯•
- âœ… ä¸º v1.1 çš„ Python å‚è€ƒæ¨¡å‹ï¼ˆ`hw_ref.py`ï¼‰æä¾›æ€è·¯
- âœ… éªŒè¯äº† INT8 å®šç‚¹æ•°çš„å¯è¡Œæ€§

**å¯ç¤º**ï¼šC è¯­è¨€åŸå‹æ˜¯ç¡¬ä»¶å®ç°çš„è‰¯å¥½è¿‡æ¸¡ã€‚

### æ•™è®­ä¸å¯å‘ ğŸ“

#### 1. **å†…å­˜è§„åˆ’è‡³å…³é‡è¦**
- âš ï¸ 32 KB RAM æ¥è¿‘æé™ï¼Œç¼ºä¹æ‰©å±•ç©ºé—´
- ğŸ’¡ **ç»éªŒ**ï¼šæå‰è§„åˆ’å†…å­˜åˆ†é…ï¼Œé¢„ç•™ 20-30% ä½™é‡

#### 2. **è½¯æ ¸ vs ç¡¬ä»¶åŠ é€Ÿçš„æƒè¡¡**
- âš ï¸ Nios II é€‚åˆæ§åˆ¶é€»è¾‘ï¼Œä¸é€‚åˆè®¡ç®—å¯†é›†ä»»åŠ¡
- ğŸ’¡ **ç»éªŒ**ï¼šæ··åˆæ¶æ„ï¼ˆNios II æ§åˆ¶ + ç¡¬ä»¶åŠ é€Ÿå™¨è®¡ç®—ï¼‰å¯èƒ½æ˜¯æœ€ä¼˜è§£

#### 3. **SimpleMLP vs CNN çš„ç²¾åº¦å·®è·**
- âš ï¸ 4% ç²¾åº¦å·®è·åœ¨æŸäº›åº”ç”¨ä¸­ä¸å¯æ¥å—
- ğŸ’¡ **ç»éªŒ**ï¼šå‡†ç¡®ç‡è¦æ±‚ > 97% æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ CNN

#### 4. **On-Chip RAM çš„å±€é™æ€§**
- âš ï¸ EP4CE10 çš„ RAM å®¹é‡é™åˆ¶äº†ç½‘ç»œè§„æ¨¡
- ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨å¤–éƒ¨ SDRAMï¼ˆå¢åŠ å¤æ‚åº¦ï¼‰
  - è¿ç§»åˆ°æ›´å¤§ FPGAï¼ˆCyclone Vï¼‰
  - é‡‡ç”¨çº¯ç¡¬ä»¶åŠ é€Ÿï¼ˆv1.1 è·¯çº¿ï¼‰

---

## é€‚ç”¨åœºæ™¯

### Nios II + SimpleMLP é€‚åˆçš„åœºæ™¯ âœ…

1. **å¿«é€ŸåŸå‹éªŒè¯**
   - éœ€æ±‚ï¼šéªŒè¯ç®—æ³•å¯è¡Œæ€§ï¼Œå¿«é€Ÿè¿­ä»£
   - ä¼˜åŠ¿ï¼šC è¯­è¨€å¼€å‘å¿«ï¼Œè°ƒè¯•å‹å¥½

2. **èµ„æºå—é™ä½†å‡†ç¡®ç‡è¦æ±‚ä¸é«˜**
   - éœ€æ±‚ï¼š95% å‡†ç¡®ç‡å¯æ¥å—
   - ä¼˜åŠ¿ï¼š36.8% LCsï¼ŒM9K å·²æ¥è¿‘æé™ä½† Logic Cells ä»æœ‰ä½™é‡

3. **æ•™å­¦ä¸å­¦ä¹ **
   - éœ€æ±‚ï¼šç†è§£ç¥ç»ç½‘ç»œæ¨ç†åŸç†
   - ä¼˜åŠ¿ï¼šä»£ç ç®€æ´æ˜“æ‡‚ï¼Œé€‚åˆå…¥é—¨

4. **æ··åˆæ¶æ„çš„æ§åˆ¶éƒ¨åˆ†**
   - éœ€æ±‚ï¼šNios II è´Ÿè´£æ§åˆ¶ï¼Œç¡¬ä»¶åŠ é€Ÿå™¨è´Ÿè´£è®¡ç®—
   - ä¼˜åŠ¿ï¼šè½¯ç¡¬ååŒï¼Œå„å–æ‰€é•¿

### ä¸é€‚åˆçš„åœºæ™¯ âŒ

1. **é«˜å‡†ç¡®ç‡è¦æ±‚**ï¼ˆ>97%ï¼‰
   - SimpleMLP å‡†ç¡®ç‡ ~95%ï¼Œæ— æ³•æ»¡è¶³
   - **å»ºè®®**ï¼šä½¿ç”¨ CNNï¼ˆTinyLeNetï¼‰

2. **å®æ—¶æ€§è¦æ±‚ä¸¥æ ¼**ï¼ˆ<10 msï¼‰
   - 14 ms å»¶è¿Ÿæ— æ³•æ»¡è¶³
   - **å»ºè®®**ï¼šä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ

3. **å¤æ‚ç½‘ç»œ**ï¼ˆå·ç§¯ã€æ± åŒ–ç­‰ï¼‰
   - CPU å®ç°å·ç§¯æ•ˆç‡ä½
   - **å»ºè®®**ï¼šä¸“ç”¨ç¡¬ä»¶åŠ é€Ÿå™¨

4. **æ‰¹å¤„ç†**ï¼ˆå¤šå›¾å¹¶è¡Œæ¨ç†ï¼‰
   - 32 KB RAM ä¸è¶³ä»¥ç¼“å­˜å¤šå¼ å›¾åƒ
   - **å»ºè®®**ï¼šå¤–éƒ¨ SDRAM æˆ–æ›´å¤§ FPGA

---

## ç»“è®º

Nios II + SimpleMLP æ–¹æ¡ˆï¼ˆv1ï¼‰æ˜¯ä¸€æ¬¡æˆåŠŸçš„æŠ€æœ¯æ¢ç´¢ï¼Œå®ƒè¯æ˜äº†ï¼š

1. âœ… **åœ¨å…¥é—¨çº§ FPGA ä¸Šå®ç°ç¥ç»ç½‘ç»œæ¨ç†æ˜¯å¯è¡Œçš„**
2. âœ… **Nios II è½¯æ ¸é€‚åˆå¿«é€ŸåŸå‹å¼€å‘ä¸çµæ´»è°ƒè¯•**
3. âœ… **SimpleMLP åœ¨èµ„æºå—é™æ¡ä»¶ä¸‹æ˜¯åˆç†é€‰æ‹©**
4. âœ… **14 ms æ¨ç†æ—¶é—´å¯¹äºå¤§éƒ¨åˆ†éå®æ—¶åº”ç”¨å·²è¶³å¤Ÿ**

**v1 ä¸ v1.1 çš„å…³ç³»**ï¼š
- **v1**ï¼šå¿«é€ŸåŸå‹ï¼ŒéªŒè¯è½¯ä»¶æµç¨‹ï¼Œæ¢ç´¢ Nios II å¯è¡Œæ€§
- **v1.1**ï¼šæè‡´ä¼˜åŒ–ï¼Œè¿½æ±‚æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ç‡ï¼Œæ¢ç´¢ç¡¬ä»¶åŠ é€Ÿ

ä¸¤ä¸ªç‰ˆæœ¬ä¸æ˜¯ç«äº‰å…³ç³»ï¼Œè€Œæ˜¯**äº’è¡¥çš„æŠ€æœ¯æ¢ç´¢è·¯å¾„**ã€‚

---

## ğŸ“Š æ•°æ®è¯´æ˜

æœ¬æ–‡æ¡£ä¸­çš„æ€§èƒ½ä¸èµ„æºæ•°æ®æ¥æºå¦‚ä¸‹ï¼š

### ç¡¬ä»¶èµ„æºæ•°æ®ï¼ˆQuartus ç»¼åˆæŠ¥å‘Šï¼‰
- **Logic Cells**: 3,800 / 10,320ï¼ˆ36.8%ï¼‰
- **M9K å­˜å‚¨å—**: 44 / 46ï¼ˆ95.7%ï¼‰
- **DSP Elements**: 4ï¼ˆå« 2 ä¸ª DSP 18Ã—18ï¼‰
- **å±‚çº§åˆ†è§£**ï¼šQsys ç³»ç»Ÿã€æ•°ç ç®¡é©±åŠ¨ã€SignalTap ç­‰ç»„ä»¶èµ„æºå ç”¨

### æ€§èƒ½æµ‹è¯•æ•°æ®
- **æ¨ç†å»¶è¿Ÿ**: 14 ms @ 50 MHzï¼ˆå•å¼  MNIST å›¾åƒï¼‰
- **æ—¶é’Ÿé¢‘ç‡**: 50 MHz
- **å¤„ç†å™¨å‹å·**: Nios II/fï¼ˆå¿«é€Ÿå‹è½¯æ ¸ï¼‰

### ç†è®ºè®¡ç®—æ•°æ® âš ï¸
- **ååç‡**: ~71 FPSï¼ˆ1000/14ï¼‰
- **å‘¨æœŸæ•°**: ~700,000ï¼ˆ14ms Ã— 50MHzï¼‰
- **ä¹˜åŠ è¿ç®—æ¬¡æ•°**: 25,408ï¼ˆæ ¹æ® SimpleMLP æ¶æ„ï¼‰

> **é‡è¦æç¤º**ï¼šç†è®ºè®¡ç®—æ•°æ®åŸºäºæ•°å­¦æ¨å¯¼å’Œå…¸å‹å‡è®¾ï¼Œå¯èƒ½ä¸å®é™…æƒ…å†µå­˜åœ¨åå·®ï¼Œä»…ä¾›å‚è€ƒã€‚

### å…¸å‹æ€§èƒ½å‚æ•° â„¹ï¸
- **SimpleMLP å‡†ç¡®ç‡**: ~95-96%ï¼ˆä¸¤å±‚ MLP åœ¨ MNIST ä¸Šçš„å…¸å‹è¡¨ç°èŒƒå›´ï¼‰
- **å†…å­˜åˆ†é…**: åŸºäºç¨‹åºç»“æ„çš„åˆç†ä¼°ç®—ï¼Œå®é™…å€¼å› ç¼–è¯‘ä¼˜åŒ–è€Œå¼‚

---

## å‚è€ƒèµ„æ–™

### ç›¸å…³æ–‡æ¡£
- [v1.1 çº¯ Verilog å®ç°](hardware/src/v1.1/README.md)
- [SimpleMLP æ¨¡å‹å®šä¹‰](model_tools/models/SimpleMLP.py)
- [ä¸» README](README.md)

### æŠ€æœ¯æ–‡æ¡£
- [Nios II å¤„ç†å™¨å®˜æ–¹æ–‡æ¡£](https://www.intel.com/content/www/us/en/docs/programmable/683632/current/nios-ii-processor.html)
- [Qsys ç³»ç»Ÿé›†æˆå·¥å…·](https://www.intel.com/content/www/us/en/docs/programmable/683440/current/introduction-to.html)
- [Eclipse Nios II è½¯ä»¶å¼€å‘](https://www.intel.com/content/www/us/en/docs/programmable/683525/current/getting-started-with-the-graphical-user.html)

### å¼€å‘æ¿æ–‡æ¡£
- [é‡ç« EP4CE10 å¼€å‘æ¿æ–‡æ¡£](https://doc.embedfire.com/fpga/altera/ep4ce10_pro/zh/latest/index.html) - Cyclone IV EP4CE10 å¼€å‘æ¿è¯¦ç»†æ•™ç¨‹ï¼ˆä¸­æ–‡ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0ï¼ˆå·²æ›´æ­£ï¼‰
**æœ€åæ›´æ–°**ï¼š2026-01-04
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆï¼ˆLegacyï¼Œä»…ä¾›å‚è€ƒï¼‰
